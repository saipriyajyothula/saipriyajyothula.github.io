<!DOCTYPE html>    
<head>
    <meta charset="utf-8">
    <title>Shower the People</title>
	
	<!-- Get version 1.5.0 of Fabric.js from CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.min.js" ></script>

<body>
        <img src = "img/power.png" id = "power" style="display:none">
		<!-- canvas tag for Fabric.js to draw into -->
		<canvas id="c" width="4140" height="2200" style="border:2px solid black;" ></canvas>
</body>

<script>

(function() {

  var localHeight = 990;
  var localWidth = 1860;

  var canvas = this.__canvas = new fabric.Canvas('c');


var arya = [99, 'medium', 'normal', 'kyloren'];
var sasha = [97, 'medium', 'divergent', 'bb8'];
var ian = [102, 'high', 'normal', 'starwars'];
var guest1 = [103, 'low', 'normal', 'orangebb8'];
var guest2 = [98, 'high', 'divergent', 'stormtrooper'];
    
var backWall = new fabric.Rect({
  left: 0,
  top: 0,
  fill: 'transparent',
  stroke: 'black',
  width: 450,
  height: localHeight,
  angle: 0
});

backWall.hasControls = backWall.hasBorders = false;
backWall.lockMovementX = backWall.lockMovementY = true;

var sideWall = new fabric.Rect({
  left: 450,
  top: 0,
  fill: 'transparent',
  stroke: 'black',
  width: 960,
  height: localHeight,
  opacity: 0.01,
  angle: 0
});

sideWall.hasControls = sideWall.hasBorders = false;
sideWall.lockMovementX = sideWall.lockMovementY = true;

var frontWall = new fabric.Rect({
  left: 1410,
  top: 0,
  fill: 'transparent',
  stroke: 'black',
  width: 450,
  height: localHeight,
  angle: 0
});

frontWall.hasControls = frontWall.hasBorders = false;
frontWall.lockMovementX = frontWall.lockMovementY = true;

var showerHead = new fabric.Circle({
  left: 1635, top: 100, radius: 20,  originX: 'center',
  originY: 'center', stroke: 'black', strokeWidth: 2,
});

var showerBathRect = new fabric.Rect({
  left: 1500,
  top: 400,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 65,
  height: 65,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});

showerBathRect.lockMovementX = showerBathRect.lockMovementY = true;    

var themeRect = new fabric.Rect({
  left: 720,
  top: 400,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 220,
  height: 100,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});

themeRect.lockMovementX = themeRect.lockMovementY = true;    
    
var tempUpArrow = new fabric.Triangle({
  left: 1635,
  top: 330,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  width: 80,
  height: 46,
  strokeWidth: 2,
  angle: 0,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});
    
tempUpArrow.lockMovementX = tempUpArrow.lockMovementY = true;
    

var tempDownArrow = new fabric.Triangle({
  left: 1635,
  top: 465,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  width: 80,
  height: 46,
  strokeWidth: 2,
  angle: 180,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});

tempDownArrow.lockMovementX = tempDownArrow.lockMovementY = true;    
    
var tempText = new fabric.Text('default', { left: 1615, top: 400, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
tempText.hasControls = tempText.hasBorders = false;
tempText.lockMovementX = tempText.lockMovementY = true;
tempText.selectable = false;
tempText.evented = false;

var tempUnitText = new fabric.Text('default', { left: 1665, top: 400, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
tempUnitText.lockMovementX = tempUnitText.lockMovementY = true;

var showerBathText = new fabric.Text('default', { left: 1500, top: 410, fontFamily: 'Helvetica', fontSize: 50, originX: 'center', originY: 'center'});
showerBathText.lockMovementX = showerBathText.lockMovementY = true;

var snowflakeText = new fabric.Text('\u2744', { left: 1635, top: 465, fontFamily: 'Helvetica', fontSize: 40, stroke: '#317eae', originX: 'center', originY: 'center'});
snowflakeText.lockMovementX = snowflakeText.lockMovementY = true;

var fireText = new fabric.Text('\uD83D\uDD25', { left: 1635, top: 340, fontFamily: 'Helvetica', fontSize: 40, originX: 'center', originY: 'center'});
fireText.lockMovementX = fireText.lockMovementY = true;

var saveText = new fabric.Text('\uD83D\uDCBE', { left: 1760, top: 565, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
saveText.lockMovementX = saveText.lockMovementY = true;

var nameText= new fabric.Text('\uD83D\uDC64 '+'Arya', { left: 1605, top: 565, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
nameText.lockMovementX = nameText.lockMovementY = true;

var themeText= new fabric.Text(' Theme\n'+'Kylo Ren', { left: 720, top: 400, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
themeText.lockMovementX = themeText.lockMovementY = true; 
    
var dateText = new fabric.Text('default', { left: 820, top: 200, fontFamily: 'Helvetica', fontSize: 35, originX: 'center', originY: 'center'});
dateText.lockMovementX = dateText.lockMovementY = true;
dateText.hasControls = dateText.hasBorders = false;
    
var tempUnitRect = new fabric.Rect({
  left: 1670,
  top: 395,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 42,
  height: 42,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});

var waterFlowRect = new fabric.Rect({
  left: 1765,
  top: 467,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 42,
  height: 42,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});
    
waterFlowRect.lockMovementX = waterFlowRect.lockMovementY = true;
    
var lowRect = new fabric.Rect({
  left: 1745,
  top: 415,
  originX: 'left',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 40,
  height: 30,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});
    
  lowRect.lockMovementX = lowRect.lockMovementY = true;    
    
var mediumRect = new fabric.Rect({
  left: 1745,
  top: 367.5,
  originX: 'left',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 60,
  height: 30,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});
      
  mediumRect.lockMovementX = mediumRect.lockMovementY = true;    

var highRect = new fabric.Rect({
  left: 1745,
  top: 320,
  originX: 'left',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 80,
  height: 30,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});
  
  highRect.lockMovementX = highRect.lockMovementY = true;    
    
var normalsprayRect = new fabric.Rect({
  left: 1635,
  top: 225,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  width: 35,
  height: 35,

});

normalsprayRect.lockMovementX = normalsprayRect.lockMovementY = true;
    
var convsprayRect = new fabric.Rect({
  left: 1710,
  top: 225,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  width: 35,
  height: 35,
});

convsprayRect.lockMovementX = convsprayRect.lockMovementY = true;
    
var divsprayRect = new fabric.Rect({
  left: 1560,
  top: 225,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  width: 35,
  height: 35,

});
    
divsprayRect.lockMovementX = divsprayRect.lockMovementY = true;

var bathSpout = new fabric.Rect({
  left: 1635,
  top: 950,
  originX: 'center',
  originY: 'center',
  stroke: 'black',
  width: 60,
  height: 30,
  angle: 0
});

var saveRect = new fabric.Rect({
  left: 1760,
  top: 560,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 60,
  height: 50,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});    
    
saveRect.lockMovementX = saveRect.lockMovementY = true;

var nameRect = new fabric.Rect({
  left: 1605,
  top: 560,
  originX: 'center',
  originY: 'center',
  fill: 'white',
  stroke: 'black',
  strokeWidth: 2,
  width: 170,
  height: 50,
  rx: 10,
  ry: 10,
  shadow: 'rgba(0,0,0,0.3) 5px 5px 5px'
});    
    
nameRect.lockMovementX = nameRect.lockMovementY = true;    
    
var waterTemp = 99;
var tempUnits = 'F';
var waterFlow = 'off';
var waterSpeed;
var bg = 'kyloren'
var ratiox = (canvas.width/localWidth);
var ratioy = (canvas.height/localHeight);
var showerBath = 'shower';
var sprayType = 'normal';
var name = 'Arya';

var powerImg = document.getElementById('power');
var power = new fabric.Image(powerImg, {
left: 1765,
top: 467,
originX: 'center',
originY: 'center',
scaleX: 0.06,
scaleY: 0.06,
});
    
fabric.Image.fromURL('img/spray_normal.png', function(normalspray) {
  normalspray = normalspray.scale(0.5).set({left: 1635*ratioy, top: 225*ratioy, originX: 'center', originY: 'center',});
  normalspray.lockMovementX = normalspray.lockMovementY = true;
  canvas.add(normalspray);
  normalspray.on('selected', function() {
  sprayType = 'normal';
  updateSprayType();
  canvas.deactivateAll(); 
});
});
    
fabric.Image.fromURL('img/spray_convergent.png', function(convspray) {
  convspray = convspray.scale(0.5).set({left: 1710*ratioy, top: 225*ratioy, originX: 'center', originY: 'center',});
  convspray.lockMovementX = convspray.lockMovementY = true;
  canvas.add(convspray);
  convspray.on('selected', function() {
  sprayType = 'conv';
  updateSprayType();
  canvas.deactivateAll(); 
});
});
    
fabric.Image.fromURL('img/spray_divergent.png', function(divspray) {
  divspray = divspray.scale(0.5).set({left: 1560*ratioy, top: 225*ratioy, originX: 'center', originY: 'center',});
  divspray.lockMovementX = divspray.lockMovementY = true;
  canvas.add(divspray);
  divspray.on('selected', function() {
  sprayType = 'div';
  updateSprayType();
  canvas.deactivateAll(); 
});
});
    
function updateWaterTemp() {
  tempText.text = String(waterTemp);
  tempUnitText.text = ' \u00B0' + tempUnits;
}

function updateShowerBath() {
  if (showerBath == 'shower'){
  showerBathText.text = '\uD83D\uDEBF';  
  }
  else {
  showerBathText.text = '\uD83D\uDEC1';  
  }
  updateWaterFlow();
}    
    
function updateSprayType() {
  if (sprayType == 'normal') {
  normalsprayRect.stroke = 'green';
  normalsprayRect.strokeWidth = 3;
  convsprayRect.stroke = divsprayRect.stroke = 'white';
  } 
else if (sprayType == 'conv') {
  convsprayRect.stroke = 'green';
  convsprayRect.strokeWidth = 3;
  normalsprayRect.stroke = divsprayRect.stroke = 'white';
}
else {
  divsprayRect.stroke = 'green';
  divsprayRect.strokeWidth = 3;
  normalsprayRect.stroke = convsprayRect.stroke = 'white';
}
}

function updateWaterFlow() {
  if (waterFlow == 'on') {
      if (showerBath == 'shower') {
      showerHead.fill = '#99cc66';
      bathSpout.fill = '#ff6666';        
      }
      else {
      showerHead.fill = '#ff6666';
      bathSpout.fill = '#99cc66';  
      }
  }
  else {
      showerHead.fill = '#ff6666';
      bathSpout.fill = '#ff6666';
      }
  updateWaterSpeed();
}

function updateWaterSpeed() {
  if (waterFlow == 'on') {
      if (waterSpeed == 'low') {
      lowRect.fill = '#99cc66';
      mediumRect.fill = 'white';
      highRect.fill = 'white';
      }
      else if (waterSpeed == 'medium') {
      lowRect.fill = '#99cc66';
      mediumRect.fill = '#99cc66';
      highRect.fill = 'white';
      }
      else {
      highRect.fill = '#99cc66';
      lowRect.fill = '#99cc66';
      mediumRect.fill = '#99cc66';    
      }
  }
  else {
  lowRect.fill = 'white';
  mediumRect.fill = 'white';
  highRect.fill = 'white';
    }
}

function updateVal() {
if (name == 'Arya') {
arya[0] = waterTemp;
arya[1] = waterSpeed;
arya[2] = sprayType;
arya[3] = bg;
}
else if (name == 'Sasha') {
sasha[0] = waterTemp;
sasha[1] = waterSpeed;
sasha[2] = sprayType;
sasha[3] = bg;
}
else if (name == 'Ian') {
ian[0] = waterTemp;
ian[1] = waterSpeed;
ian[2] = sprayType;
ian[3] = bg;
}
else if (name == 'Guest1') {
guest1[0] = waterTemp;
guest1[1] = waterSpeed;
guest1[2] = sprayType;
guest1[3] = bg;
}
else if (name == 'Guest2') {
guest2[0] = waterTemp;
guest2[1] = waterSpeed;
guest2[2] = sprayType;
guest2[3] = bg;
}    
}

function displayVal() {
if (name == 'Arya') {
waterTemp = arya[0];
waterSpeed = arya[1];
sprayType = arya[2];
bg = arya[3];
}
else if (name == 'Sasha') {
waterTemp = sasha[0];
waterSpeed = sasha[1];
sprayType = sasha[2];
bg = sasha[3];
}
else if (name == 'Ian') {
waterTemp = ian[0];
waterSpeed = ian[1];
sprayType = ian[2];
bg = ian[3];
}
else if (name == 'Guest1') {
waterTemp = guest1[0];
waterSpeed = guest1[1];
sprayType = guest1[2];
bg = guest1[3];
}
else if (name == 'Guest2') {
waterTemp = guest2[0];
waterSpeed = guest2[1];
sprayType = guest2[2];
bg = guest2[3];
}
tempUnits = 'F';
updateWaterTemp();
updateSprayType();
updateWaterSpeed();
updateTheme();
}

function updateTheme() {
if (bg == 'kyloren'|| bg == 'starwars'){
    tempText.fill = 'white';
}
else {
    tempText.fill = 'black';
}
canvas.setBackgroundImage('img/'+bg+'.jpg', canvas.renderAll.bind(canvas));    
}    
    
function updateControls() {
if (showerBath == 'shower'){
showerBathRect.top = showerBathRect.top - 660;
showerBathText.top = showerBathText.top - 660;
}
else {
showerBathRect.top = showerBathRect.top + 660;
showerBathText.top = showerBathText.top + 660;
    }
}    

function startTime() {
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    dateText.text = h + ":" + m + ":" + s;
    var t = setTimeout(startTime, 100);
}
function checkTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
    
updateWaterTemp();
updateSprayType();
updateShowerBath();
updateWaterFlow();
updateWaterSpeed();
updateTheme();
startTime();
    
tempUpArrow.on('selected', function() {
  waterTemp++;
  updateWaterTemp();
  canvas.deactivateAll(); 
});

tempDownArrow.on('selected', function() {
  waterTemp--;
  updateWaterTemp();
  canvas.deactivateAll(); 
});

showerBathRect.on('selected', function() {
if(showerBath == 'shower'){
        showerBath = 'bath';
    }
else {
        showerBath = 'shower';
    }
updateControls();
updateShowerBath();
canvas.deactivateAll(); 
});    

showerBathText.on('selected', function() {
if(showerBath == 'shower'){
        showerBath = 'bath';
    }
    else {
        showerBath = 'shower';
    }
updateControls();
updateShowerBath();
canvas.deactivateAll(); 
});     
    
tempUnitText.on('selected', function() {
  if (tempUnits == 'F') {
  tempUnits = 'C';
  waterTemp = (5/9)*(waterTemp-32);
  } 
else {
  tempUnits = 'F';
  waterTemp = ((9/5)*waterTemp)+32;
  }
  waterTemp = Math.round(waterTemp);
  updateWaterTemp();
  canvas.deactivateAll(); 
});      

  fireText.on('selected', function() {
  waterTemp++;
  updateWaterTemp();
  canvas.deactivateAll(); 
});
    
  snowflakeText.on('selected', function() {
  waterTemp--;
  updateWaterTemp();
  canvas.deactivateAll(); 
});

power.on('selected', function() {
  if (waterFlow == 'on') {
      waterFlow = 'off';
  }
  else {
      waterFlow = 'on';
      waterSpeed = 'low';
  }
  updateWaterFlow();
  canvas.deactivateAll(); 
});    
    
waterFlowRect.on('selected', function() {
  if (waterFlow == 'on') {
      waterFlow = 'off';
  }
  else {
      waterFlow = 'on';
      waterSpeed = 'low';
  }
  updateWaterFlow();
  canvas.deactivateAll(); 
});
    
lowRect.on('selected', function() {
  waterFlow = 'on';
  waterSpeed = 'low';
  updateWaterSpeed();
  canvas.deactivateAll(); 
});

mediumRect.on('selected', function() {
  waterFlow = 'on';
  waterSpeed = 'medium';
  updateWaterSpeed();
  canvas.deactivateAll(); 
});

highRect.on('selected', function() {
  waterFlow = 'on';
  waterSpeed = 'high';
  updateWaterSpeed();
  canvas.deactivateAll(); 
});

nameText.on('selected', function() {
if (name == 'Arya') {
name = 'Sasha';
}
else if (name == 'Sasha') {
name = 'Ian';
}
else if (name == 'Ian') {
name = 'Guest1';
}
else if (name == 'Guest1') {
name = 'Guest2';
}
else if (name == 'Guest2') {
name = 'Arya';
}
saveRect.stroke = 'black';
nameText.text = '\uD83D\uDC64 '+name;
displayVal();
canvas.deactivateAll();
}); 

nameRect.on('selected', function() {
if (name == 'Arya') {
name = 'Sasha';
}
else if (name == 'Sasha') {
name = 'Ian';
}
else if (name == 'Ian') {
name = 'Guest1';
}
else if (name == 'Guest1') {
name = 'Guest2';
}
else if (name == 'Guest2') {
name = 'Arya';
}
saveRect.stroke = 'black';
nameText.text = '\uD83D\uDC64 '+name;
displayVal();
canvas.deactivateAll();
});    
    
saveText.on('selected', function() {
if (tempUnits == 'C'){
    waterTemp = (1.8*waterTemp)+32;
}
saveRect.stroke = 'green';
saveRect.strokeWidth = 6;
updateVal();
canvas.deactivateAll();
});
    
saveRect.on('selected', function() {
if (tempUnits == 'C'){
    waterTemp = Math.round((1.8*waterTemp)+32);
}
saveRect.stroke = 'green';
saveRect.strokeWidth = 6;
updateVal();
canvas.deactivateAll();
});

themeRect.on('selected', function() {
if (bg == 'kyloren'){
    bg = 'orangebb8';
    themeText.text = '    Theme\n'+'Orange BB-8';
}
else if (bg == 'orangebb8'){
    bg = 'stormtrooper';
    themeText.text = '    Theme\n'+'Stormtrooper';
}
else if (bg == 'stormtrooper'){
    bg = 'bb8';
    themeText.text = 'Theme\n'+'  BB-8';
}
else if (bg == 'bb8'){
    bg = 'starwars';
    themeText.text = '  Theme\n'+'Star Wars';
}
else if (bg == 'starwars'){
    bg = 'none'
    themeText.text = ' Theme\n'+'  None';
} 
else {
    bg = 'kyloren'
    themeText.text = ' Theme\n'+'Kylo Ren';
}                
updateTheme();
canvas.deactivateAll();
});

themeText.on('selected', function() {
if (bg == 'kyloren'){
    bg = 'orangebb8';
    themeText.text = '    Theme\n'+'Orange BB-8';
}
else if (bg == 'orangebb8'){
    bg = 'stormtrooper';
    themeText.text = '    Theme\n'+'Stormtrooper';
}
else if (bg == 'stormtrooper'){
    bg = 'bb8';
    themeText.text = 'Theme\n'+'  BB-8';
}
else if (bg == 'bb8'){
    bg = 'starwars';
    themeText.text = '  Theme\n'+'Star Wars';
}
else if (bg == 'starwars'){
    bg = 'none'
    themeText.text = ' Theme\n'+'  None';
} 
else {
    bg = 'kyloren'
    themeText.text = ' Theme\n'+'Kylo Ren';
}                
updateTheme();
canvas.deactivateAll();
});
    
canvas.add(backWall);
canvas.add(sideWall);
canvas.add(frontWall);
canvas.add(showerHead);
canvas.add(bathSpout);
canvas.add(tempUpArrow);
canvas.add(fireText);
canvas.add(tempDownArrow);
canvas.add(snowflakeText);
canvas.add(tempText);
canvas.add(tempUnitRect);
canvas.add(tempUnitText);
canvas.add(lowRect);
canvas.add(mediumRect);
canvas.add(highRect);
canvas.add(waterFlowRect);
canvas.add(power);
canvas.add(showerBathRect);
canvas.add(normalsprayRect);
canvas.add(convsprayRect);
canvas.add(divsprayRect);
canvas.add(showerBathText);
canvas.add(saveRect);
canvas.add(saveText);
canvas.add(nameRect);
canvas.add(nameText);
canvas.add(themeRect);
canvas.add(themeText);
canvas.add(dateText);
    
function zoomAll(SCALE_FACTOR) {

      var objects = canvas.getObjects();
      for (var i in objects) {
          var scaleX = objects[i].scaleX;
          var scaleY = objects[i].scaleY;
          var left = objects[i].left;
          var top = objects[i].top;

          var tempScaleX = scaleX * SCALE_FACTOR;
          var tempScaleY = scaleY * SCALE_FACTOR;
          var tempLeft = left * SCALE_FACTOR;
          var tempTop = top * SCALE_FACTOR;

          objects[i].scaleX = tempScaleX;
          objects[i].scaleY = tempScaleY;
          objects[i].left = tempLeft;
          objects[i].top = tempTop;

          objects[i].setCoords();
      }
  
      canvas.renderAll();
  }

zoomAll(ratioy);

})();

</script>
		
</head>
  
</html>