<html >    
<head>
    <meta charset="utf-8">
    <title>SmartDoor&trade;</title>
	
	<!-- Get version 1.5.0 of Fabric.js from CDN -->
    
<!--    adding the javascript libraries, audio, video and image sources-->
    
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.min.js" ></script>
    <script src="js/jquery-1.12.0.min.js"></script>
    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.4.0/annyang.min.js"></script>
    <audio src="music/uptown.mp3" id="uptown" style="display:none"></audio>
    <audio src="music/marvin.mp3" id="marvin" style="display:none"></audio>
    <audio src="music/sugar.mp3" id="sugar" style="display:none"></audio>
    <audio src="music/chime1.mp3" id="chime1" style="display:none"></audio>
    <audio src="music/chime2.mp3" id="chime2" style="display:none"></audio>
    <audio src="music/chime3.mp3" id="chime3" style="display:none"></audio>
    <img src="img/doorbellGray.png" id="dg" style="display:none">
    <img src="img/packageGray.png" id="pg" style="display:none">
    <video height="182" width="210" id="inVideo" style="display: none">
        <source src="http://www.quirksmode.org/html5/videos/big_buck_bunny.mp4">
    </video>
    <video height="1367" width="875" id="outVideo" style="display: none">
        <source src="music/Out.mp4">
    </video>
    <video height="680" width="1060" id="helpVideo" style="display: none">
        <source src="music/helpvideo.mp4">
    </video>
    <link href="css/style.css" rel="stylesheet">
	 
<!--    creating canvases for main apps screen, side apps screen, inside window, outside apps and outside window-->
    
<body style="width: 3400px; position: relative;">
    
    <canvas id="c" width="2714" height="2200" style="border:2px solid black"></canvas>
    
    <div id = "mainApps" style="position:absolute; top:8; left:58; display: none">
        <canvas id="main" width="1230" height="2200" style="border:2px solid black" ></canvas>
    </div>
    
    <div id = "sideApps" style="position:absolute; top:8; left:58; display: none">
        <canvas id="side" width="1230" height="2200" style="border:2px solid black" ></canvas>
    </div>
    
    <div id = "outApps" style="position:absolute; top:8; left:1428; display: none">
        <canvas id="out" width="1230" height="2200" style="border:2px solid black" ></canvas>
    </div>
    
    <div id = "insideWindow" style="position:absolute; top:8; left:58; display: none">
        <canvas id="inWindow" width="1230" height="2200" style="border:2px solid black" ></canvas>
    </div>
    
    <div id = "outsideWindow" style="position:absolute; top:8; left:1428; display: none">
        <canvas id="outWindow" width="1230" height="2200" style="border:2px solid black" ></canvas>
    </div>
    
    <div id = "DoodIt" style="position:absolute; top:0; left:0; display: none">
        <canvas id="DoodleSheet" width="1015" height="1200" style="border: 2px solid black"></canvas>
    </div>

    <div id = "LoadDood" style="position:absolute; top:0; left:0; display: none">
        <canvas id="LoadDoodSheet" width="1230" height="2200" style="border: 2px solid black"></canvas>
    </div>
    
<!--    adding buttons for external events-->
    
<div style="position: absolute; top: 850;
            right: 0;">
    <p style="font-size: 32px; font-family: HelveticaLight">Text message</p>
	<button onclick="displayTextA()">All</button>
    <p id="All"></p>
	<button onclick="displayTextSa()">Sai</button>
    <p id="Sai"></p>
	<button onclick="displayTextg()">Gautam</button>
	<p id="Gautam"></p>
	<button onclick="displayTextSu()">Sumanth</button>
	<p id="Sumanth"></p>
	<button onclick="displayTextVi()">Vinit</button>
	<p id="Vinit"></p>
    
	</div>
	
	<div id ="dood" style="position: absolute; top: 850;
            right: 360px;">
    <p style="font-size: 32px; font-family: HelveticaLight">Doodle</p>
        
	<button onclick="displayDoodA()">All</button>
    <p id="All"></p>
	<button onclick="displayDoodSa()">Sai</button>
    <p id="Sai"></p>
	<button onclick="displayDoodg()">Gautam</button>
	<p id="Gautam"></p>
	<button onclick="displayDoodSu()">Sumanth</button>
	<p id="Sumanth"></p>
	<button onclick="displayDoodVi()">Vinit</button>
	<p id="Vinit"></p>
    </div>
        
    <div id ="appr" style="position: absolute; top: 1580;
            right: 225px;">
    <button id="approach" onclick="approaching()">Approach</button>
	 </div>
    
    
    <div id = "DisplayDood" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodC" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayDoodU1" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodCU1" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayDoodU2" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodCU2" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayDoodU3" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodCU3" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayDoodU4" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodCU4" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
    
	<div id = "DisplayDoodUAl" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayDoodCUAl" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayTextAl" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayTextCAl" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayTextU1" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayTextCU1" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayTextU2" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayTextCU2" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayTextU3" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayTextCU3" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DisplayTextU4" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DisplayTextCU4" width="885" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "DefaultTe" style="position:absolute; top:0; left:0; display: none">
		<canvas id="DefaultText" width="880" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "InOut" style="position:absolute; top:0; left:0; display: none">
		<canvas id="InOutText" width="880" height="480" style="border: 2px solid black"></canvas>
	</div>
	
	<div id = "InOutMainD" style="position:absolute; top:0; left:0; display: none">
		<canvas id="InOutTextMainD" width="1060" height="570" style="border: 2px solid black"></canvas>
	</div>
    
</body>

<!--    script dependencies-->
    
<script src = "js/dependencies.js"></script>
<script src = "js/timeweather.js"></script>
<script src = "js/emergency.js"></script>
<script src = "js/news.js"></script>
<script src = "js/alarmdnd.js"></script>
<script src = "js/music.js"></script>
<script src = "js/themes.js"></script>
<script src = "js/logs.js"></script>
<script src = "js/settings.js"></script> 
<script src = "js/scrmaps.js"></script>
<script src = "js/doodle.js"></script>
<script src = "js/galleryStore.js"></script>
<script src = "js/camera.js"></script>
<script src = "js/messages.js"></script>
    
<script>

//top green rectangle for opening the door    
    
var openRect = new fabric.Rect({
      left: 0,
      top: 0,
      fill: 'green',
      stroke: 'white',
      width: 1230,
      height: 30,
      angle: 0
      });
openRect.hasControls = openRect.hasBorders = false;
openRect.lockMovementX = openRect.lockMovementY = true;    
    
//    navigation arrows on the main apps screen
    
function arrowsMain(){
    fabric.Image.fromURL('img/arrowleft.png', function(arrowleft) {
      arrowleft.set({left: 110,
      top: topLength+310, originY: 'center', lockMovementX: true, lockMovementY: true});    
      mainApps.add(arrowleft);
      arrowleft.on('mousedown',function(){
          mainApps.deactivateAll();
          divMain.style.display = 'none';
          divSide.style.display = 'block';
    });
    });
    
    fabric.Image.fromURL('img/arrowright.png', function(arrowright) {
      arrowright.set({left: 1120,
      top: topLength+310, originX: 'right', originY: 'center', lockMovementX: true, lockMovementY: true});    
      mainApps.add(arrowright);
      arrowright.on('mousedown',function(){
          mainApps.deactivateAll();
          divMain.style.display = 'none';
          divSide.style.display = 'block';
    });
    });
}

// function to display the main apps screen    
    
function mainscreen() {
    
    divMain.style.display = 'block';
    arrowsMain();
    
//    *********icons start
    
    fabric.Image.fromURL('img/Mirror.png', function(mirror) {
      mirror.set({left:leftWidth,
      top: topLength, originX: 'left', originY: 'top', lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(mirror);
      mirror.on('mousedown',function(){
          getMirror();
    });
    });

    fabric.Image.fromURL('img/Messages.png', function(messages) {
      messages.set({left:leftWidth+220,
      top: topLength, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(messages);
      messages.on('mousedown',function(){
            addLock();
            sendText();
    });    
    });

    fabric.Image.fromURL('img/Camera.png', function(camera) {
      camera.set({left:leftWidth+440,
      top: topLength, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(camera);
      camera.on('mousedown',function(){
          addLock();
          getCamera();
    });    
    });


    fabric.Image.fromURL('img/Emergency.png', function(emergency) {
      emergency.set({left:leftWidth+660,
      top: topLength});    
      mainApps.add(emergency);
      emergency.lockMovementX = emergency.lockMovementY = true;
      emergency.selectable = false;
      emergency.on('mousedown',function(){
          mainApps.deactivateAll();
          addLock();
          emergencyWindow1();
    });
    }); 

    fabric.Image.fromURL('img/Alarm.png', function(alarm) {
      alarm.set({left: leftWidth,
      top: topLength+250, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(alarm);
      alarm.on('mousedown',function(){
          addLock();
          alarmWindow();
    });
    });

    fabric.Image.fromURL('img/Themes.png', function(themes) {
      themes.set({left: leftWidth+220,
      top: topLength+250, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(themes);
      themes.on('mousedown',function(){
          addLock();
          updateTheme();
    });
    });    

    fabric.Image.fromURL('img/Music.png', function(music) {
      music.set({left: leftWidth+440,
      top: topLength+250, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(music);
      music.on('mousedown',function(){
          addLock();
          mainApps.deactivateAll();
          musicPlayer();
    });
    });    

    fabric.Image.fromURL('img/News.png', function(news) {
      news.set({left: leftWidth+660,
      top: topLength+250, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(news);
      news.on('mousedown',function(){
          addLock();
          mainApps.deactivateAll();
          getNews();
    });
    });    

    fabric.Image.fromURL('img/Logs.png', function(logs) {
      logs.set({left: leftWidth,
      top: topLength+500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(logs);
      logs.on('mousedown',function(){
          addLock();
          getLogs();
    });
    });    

    fabric.Image.fromURL('img/Settings.png', function(settings) {
      settings.set({left: leftWidth+220,
      top: topLength+500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(settings);
      settings.on('mousedown',function(){
        addLock();
        updateSettings();
    });
    });    

    fabric.Image.fromURL('img/DND.png', function(dnd) {
      dnd.set({left: leftWidth+440,
      top: topLength+500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(dnd);
      dnd.on('mousedown',function(){
          addLock();
          dndWindow();
    });
    });    

    fabric.Image.fromURL('img/Help.png', function(help) {
      help.set({left: leftWidth+660,
      top: topLength+500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      mainApps.add(help);
      help.on('mousedown',function(){
          addInhandle();
          mainApps.deactivateAll();
          getHelp();
    });
    });
    
//    *********icons end
    
// Handle for inside door
    
    fabric.Image.fromURL('img/inhandle.png', function(inhandle) {
      inhandle.set({left: 1165,
      top: 1325, originX: 'right', lockMovementX: true, lockMovementY: true, scaleX: 0.8, scaleY: 0.8, hasControls: false, hasBorders: false});    
      mainApps.add(inhandle);
      mainApps.moveTo(inhandle, 50);
    });
    
    
// accessibility icon
    
    fabric.Image.fromURL('img/accessibility.png', function(accessibility) {
      accessibility.set({left: 1165,
      top: 1450, originX: 'right', originY: 'top', lockMovementX: true, lockMovementY: true, scaleX: 0.6, scaleY: 0.6, hasControls: false, hasBorders: false});   
      mainApps.add(accessibility); 
      sideApps.add(accessibility); 
      var timer = 0;
      accessibility.on('mouseup', function() {
           var d = new Date();
           timer = d.getTime();
      });
      accessibility.on('mousedown', function() {
           var d = new Date();
           if ((d.getTime() - timer) < 500) {
               changeTopLength();
           }
           else if(((d.getTime() - timer) > 500)) {
           mainApps.add(openRect);      
           sideApps.add(openRect);      
           openRect.opacity=1;
           setTimeout(function(){
            mainApps.remove(openRect);  
            sideApps.remove(openRect); 
           },4000);          
          }
      mainApps.deactivateAll();
      sideApps.deactivateAll();
      });
    });

    
//    ******** text description below the app icons start
    
    var mirrorText = new fabric.Text('default', { left: leftWidth+58, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    mirrorText.text = (language == 0) ? 'Mirror' : 'Espejo';
    mirrorText.hasControls = mirrorText.hasBorders = false;
    mirrorText.lockMovementX = mirrorText.lockMovementY = true;
    mirrorText.selectable = false;
    mirrorText.evented = false;

    var messagesText = new fabric.Text('default', { left: leftWidth+278, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    messagesText.text = (language == 0) ? 'Messages' : 'Mensajes';
    messagesText.hasControls = messagesText.hasBorders = false;
    messagesText.lockMovementX = messagesText.lockMovementY = true;
    messagesText.selectable = false;
    messagesText.evented = false;    

    var cameraText = new fabric.Text('default', { left: leftWidth+498, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    cameraText.text = (language == 0) ? 'Camera' : 'Cámara';
    cameraText.hasControls = cameraText.hasBorders = false;
    cameraText.lockMovementX = cameraText.lockMovementY = true;
    cameraText.selectable = false;
    cameraText.evented = false;

    var emergencyText = new fabric.Text('default', { left: leftWidth+718, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    emergencyText.text = (language == 0) ? 'Emergency' : 'Emergenc..';
    emergencyText.hasControls = emergencyText.hasBorders = false;
    emergencyText.lockMovementX = emergencyText.lockMovementY = true;
    emergencyText.selectable = false;
    emergencyText.evented = false;    

    var alarmText = new fabric.Text('default', { left: leftWidth+58, top: topLength+395, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    alarmText.text = (language == 0) ? 'Alarm' : 'Alarma';
    alarmText.hasControls = alarmText.hasBorders = false;
    alarmText.lockMovementX = alarmText.lockMovementY = true;
    alarmText.selectable = false;
    alarmText.evented = false;    

    var themesText = new fabric.Text('default', { left: leftWidth+278, top: topLength+395, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    themesText.text = (language == 0) ? 'Themes' : 'Temas';
    themesText.hasControls = themesText.hasBorders = false;
    themesText.lockMovementX = themesText.lockMovementY = true;
    themesText.selectable = false;
    themesText.evented = false;    

    var musicText= new fabric.Text('default', { left: leftWidth+498, top: topLength+395, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    musicText.text = (language == 0) ? 'Music' : 'Música';
    musicText.hasControls = musicText.hasBorders = false;
    musicText.lockMovementX = musicText.lockMovementY = true;
    musicText.selectable = false;
    musicText.evented = false;

    var newsText = new fabric.Text('default', { left: leftWidth+718, top: topLength+395, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    newsText.text = (language == 0) ? 'News' : 'Noticias';
    newsText.hasControls = newsText.hasBorders = false;
    newsText.lockMovementX = newsText.lockMovementY = true;
    newsText.selectable = false;
    newsText.evented = false;    

    var logsText = new fabric.Text('default', { left: leftWidth+58, top: topLength+645, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    logsText.text = (language == 0) ? 'Logs' : 'Registros';
    logsText.hasControls = logsText.hasBorders = false;
    logsText.lockMovementX = logsText.lockMovementY = true;
    logsText.selectable = false;
    logsText.evented = false;    

    var settingsText = new fabric.Text('default', { left: leftWidth+278, top: topLength+645, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    settingsText.text = (language == 0) ? 'Settings' : 'Ajustes';
    settingsText.hasControls = settingsText.hasBorders = false;
    settingsText.lockMovementX = settingsText.lockMovementY = true;
    settingsText.selectable = false;
    settingsText.evented = false;    

    var  dndText= new fabric.Text('default', { left: leftWidth+498, top: topLength+645, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    dndText.text = (language == 0) ? 'DND' : 'DND';
    dndText.hasControls = dndText.hasBorders = false;
    dndText.lockMovementX = dndText.lockMovementY = true;
    dndText.selectable = false;
    dndText.evented = false;

    var helpText = new fabric.Text('default', { left: leftWidth+718, top: topLength+645, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    helpText.text = (language == 0) ? 'Help' : 'Ayuda';
    helpText.hasControls = helpText.hasBorders = false;
    helpText.lockMovementX = helpText.lockMovementY = true;
    helpText.selectable = false;
    helpText.evented = false;
    
    
//    ******** text description below the app icons end
    
//    lock unlock swiping action 
    
    if(up == 1){
           fabric.Image.fromURL('img/lockRect.png', function(lockRect){
           lockRect.set({left :  225, top: 1286,hasControls: false,hasBorders: false,lockMovementX: true,lockMovementY:true});
           mainApps.add(lockRect);
           mainApps.moveTo(lockRect, -100);
           sideApps.add(lockRect);
           sideApps.moveTo(lockRect, -100);
           });
        
           var  doorLockText= new fabric.Text('default', { left: 585, top: 1325, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
           doorLockText.hasControls = doorLockText.hasBorders = false;
           doorLockText.lockMovementX = doorLockText.lockMovementY = true;
           doorLockText.selectable = false;
           doorLockText.evented = false;
           mainApps.add(doorLockText);        
           sideApps.add(doorLockText);
        
             fabric.Image.fromURL('img/unlock_door.png', function(lock) {
             lock.set({left: 240,
             top: 1366, originY: 'center', lockMovementY: true, scaleX: 1, scaleY: 1, hasBorders: false, hasControls: false});    
             
             fabric.Image.fromURL('img/lock_door.png', function(unlock) {
             unlock.set({left: 730,
             top: 1366, originY: 'center', lockMovementY: true, scaleX: 1, scaleY: 1, hasBorders: false, hasControls: false});
                 
            if(lockStatus == 1){
                moveRight();
            }
            else{
                moveLeft();
            }
                 
             mainApps.on('object:moving',function(){
                 mainApps.deactivateAll();
                 if(lock.getLeft() < 240){
                     lockStatus = 0;
                     lock.set({left: 240});
                 }
                 else if(lock.getLeft() > 485){
                     moveRight();
                 }
                 if(unlock.getLeft() > 730){
                     lockStatus = 1;
                     unlock.set({left: 730});
                 }
                 else if(unlock.getLeft() < 485){
                     moveLeft();
                 }
               });
                 
             sideApps.on('object:moving',function(){
                 sideApps.deactivateAll();
                 if(lock.getLeft() < 240){
                     lockStatus = 0;
                     lock.set({left: 240});
                 }
                 else if(lock.getLeft() > 485){
                     moveRight();
                 }
                 if(unlock.getLeft() > 730){
                     lockStatus = 1;
                     unlock.set({left: 730});
                 }
                 else if(unlock.getLeft() < 485){
                     moveLeft();
                 }
               });     
            
            if (annyang) {

                var commands = {'Smart Door Unlock': function() { moveLeft();}
                    ,'Smart Door Desbloquear':function() { moveLeft();}
                    ,'Smart Door Lock':function() { moveRight();}  
                    ,'Smart Door Bloquear':function() { moveRight();}                 
               };
               annyang.addCommands(commands);
               annyang.start();
            }   
            fabric.Image.fromURL('img/accessibility.png', function(accessibility) {
      accessibility.set({left: 1165,
      top: 1450, originX: 'right', originY: 'top', lockMovementX: true, lockMovementY: true, scaleX: 0.6, scaleY: 0.6, hasControls: false, hasBorders: false});   
      mainApps.add(accessibility); 
      sideApps.add(accessibility); 
      var timer = 0;
      accessibility.on('mouseup', function() {
           var d = new Date();
           timer = d.getTime();
      });
      accessibility.on('mousedown', function() {
           var d = new Date();
           if ((d.getTime() - timer) < 500) {
               changeTopLength();
           }
           else if(((d.getTime() - timer) > 500)) {
           mainApps.add(openRect);      
           sideApps.add(openRect);      
           openRect.opacity=1;
           moveLeft();       
           setTimeout(function(){
            mainApps.remove(openRect);  
            sideApps.remove(openRect); 
           },4000);          
          }
      mainApps.deactivateAll();
      sideApps.deactivateAll();
      });
    });     
                 
            function moveLeft(){
                lockStatus = 0;
                 //console.log(lockStatus);
                 unlock.opacity=0;
                 mainApps.remove(unlock);
                 mainApps.remove(unlock);
                 sideApps.remove(unlock);
                 sideApps.remove(unlock);
                 lock.set({left: 240});
                 unlock.set({left: 730});
                 lock.opacity=1;
                 mainApps.add(lock);
                 sideApps.add(lock);
                 doorLockText.set({left: 585});
                 doorLockText.text = (language == 0) ? 'Door Unlocked \n\(Slide to Lock\)' : 'Desbloqueo de puerta \n\(Diapositiva a la cerradura\)';
                 responsiveVoice.speak((language == 0) ? 'Door Unlocked' : 'Desbloqueo de puerta');
            }

            function moveRight(){
                lockStatus = 1;
                 //console.log(lockStatus);
                 lock.opacity=0;
                 mainApps.remove(lock);
                 mainApps.remove(lock);
                 sideApps.remove(lock);
                 sideApps.remove(lock);
                 unlock.set({left: 730});
                 lock.set({left: 240});
                 unlock.opacity=1;
                 mainApps.add(unlock);
                 sideApps.add(unlock);
                 doorLockText.set({left: 480});
                 doorLockText.text = (language == 0) ? 'Door Locked \n\(Slide to Unlock\)' : 'Puerta Cerrada \n\(Deslice para desbloquear\)';
                 responsiveVoice.speak((language == 0) ? 'Door Locked' : 'Puerta Cerrada');
            }
           });  
           });
    } 
    
    mainApps.add(mirrorText);
    mainApps.add(messagesText);
    mainApps.add(cameraText);
    mainApps.add(emergencyText);
    mainApps.add(alarmText);
    mainApps.add(themesText);
    mainApps.add(musicText);
    mainApps.add(newsText);
    mainApps.add(logsText);
    mainApps.add(settingsText);
    mainApps.add(dndText);
    mainApps.add(helpText);
    
    //add red badge to alarm and dnd icons in case of abnormal status
    
    if(up == 1){alarmRedCircle.top = 700;}
    else{alarmRedCircle.top = 1150;}
    if(alarmStatus == 1){
    alarmRedCircle.strokeWidth = 0;
    alarmRedCircle.fill = 'transparent';
    }
    mainApps.add(alarmRedCircle);
    mainApps.moveTo(alarmRedCircle, 100);
    
    if(up == 1){dndRedCircle.top = 950;}
    else{dndRedCircle.top = 1400;}
    if(dndStatus == 0){
    dndRedCircle.strokeWidth = 0;
    dndRedCircle.fill = 'transparent';
    }
    mainApps.add(dndRedCircle);
    mainApps.moveTo(dndRedCircle, 100);
    
    UserDefApps.style.display = 'block';
	UserDefApps.style.left = '1600px';
	UserDefApps.style.top = '1000px';
	
	var MessRect1 = new fabric.IText(' ',{
      left: 60,
      top: 60,
      fill: 'black',
      stroke: 'black',
      strokeWidth: 2,
	  fontFamily: 'HelveticaLight',
	fontSize:38
    });
	//outApps.add(MessRect);
    MessRect1.hasControls = MessRect1.hasBorders = false;
    MessRect1.lockMovementX = MessRect1.lockMovementY = true;
	
	var MessageBoX = new fabric.Rect({
      left: 0,
      top: 0,
      fill: 'white',
      stroke: 'black',
      strokeWidth: 5,
      width: 5000,
      height: 500,
      rx: 0,
      ry: 0,
      angle: 0
    });
	//outApps.add(MessageBoX);
	MessageBoX.hasControls = MessageBoX.hasBorders = false;
    MessageBoX.lockMovementX = MessageBoX.lockMovementY = true;
	
	//DefaultCanvas.add(MessageBoX);
	DefaultCanvas.add(MessRect1);
	MessRect1.setText('Hi! Have a great day.. Leave a message if you' +'\n'+ 'want to');

}
    
// accessibility functionality    
    
function changeTopLength(){
    if(up == 0){
        up = 1;
        topLength = 450;
    }
    else{
        up = 0;
        topLength = 900;
    }
    restructureMainSide();
}    

//clear and redraw the main and side apps screen    
    
function restructureMainSide(){
    sideApps.clear();
    sidescreen();
    mainApps.clear();
    mainscreen();
    mainApps.renderAll.bind(mainApps);
    inWindow.renderAll.bind(inWindow);
    sideApps.renderAll.bind(sideApps);
    getWeather();
    mainApps.add(timeText);
    mainApps.add(dateText);
    sideApps.add(timeText);
    sideApps.add(dateText);
    mainApps.add(tempText);
    mainApps.add(tempDesText);
    sideApps.add(tempText);
    sideApps.add(tempDesText);
}    
    
//    navigation arrows on the side apps screen
    
function arrowsSide(){
    fabric.Image.fromURL('img/arrowleft.png', function(arrowleft) {
      arrowleft.set({left: 110,
      top: topLength+310, originY: 'center', lockMovementX: true, lockMovementY: true});    
      sideApps.add(arrowleft);
      arrowleft.on('mousedown',function(){
          sideApps.deactivateAll();
          divSide.style.display = 'none';
          divMain.style.display = 'block';
    });
    });
    
    fabric.Image.fromURL('img/arrowright.png', function(arrowright) {
      arrowright.set({left: 1120,
      top: topLength+310, originX: 'right', originY: 'center', lockMovementX: true, lockMovementY: true});    
      sideApps.add(arrowright);
      arrowright.on('mousedown',function(){
          sideApps.deactivateAll();
          divSide.style.display = 'none';
          divMain.style.display = 'block';
    });
    });
}    

// function to display the side apps screen    
    
function sidescreen(){
    
    arrowsSide();
    
    //    *********icons start
    
    fabric.Image.fromURL('img/Doodle.png', function(doodle) {
      doodle.set({left:leftWidth,
      top: topLength, originX: 'left', originY: 'top', lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      sideApps.add(doodle);
      doodle.on('mousedown',function(){
          addLock();
          IfCanvasEmpty();
    });
    });

    fabric.Image.fromURL('img/ScreenCast.png', function(screencast) {
      screencast.set({left:leftWidth+220,
      top: topLength, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      sideApps.add(screencast);
      screencast.on('mousedown',function(){
            addLock();
            getScreencast();
    });    
    });

    fabric.Image.fromURL('img/Gallery.png', function(gallery) {
      gallery.set({left:leftWidth+440,
      top: topLength, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      sideApps.add(gallery);
      gallery.on('mousedown',function(){
            addLock();
            getGallery();
    });   
    });


    fabric.Image.fromURL('img/Store.png', function(store) {
      store.set({left:leftWidth+660,
      top: topLength, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      sideApps.add(store);
      store.lockMovementX = store.lockMovementY = true;
      store.selectable = false;
      store.on('mousedown',function(){
          addLock();
          sideApps.deactivateAll();
          getStore();
    });
    }); 
    
    fabric.Image.fromURL('img/Maps.png', function(maps) {
      maps.set({left: leftWidth,
      top: topLength+250, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      sideApps.add(maps);
      maps.on('mousedown',function(){
          addLock();
          getMaps();
    });
    });
    
    //    *********icons end
    
    fabric.Image.fromURL('img/inhandle.png', function(inhandle) {
      inhandle.set({left: 1165,
      top: 1325, originX: 'right', lockMovementX: true, lockMovementY: true, scaleX: 0.8, scaleY: 0.8, hasControls: false, hasBorders: false});    
      sideApps.add(inhandle);
      sideApps.moveTo(inhandle, 50);
    });

    //    ******** text description below the app icons start
    
    var doodleText = new fabric.Text('default', { left: leftWidth+58, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    doodleText.text = (language == 0) ? 'Doodle' : 'Garabate..';
    doodleText.hasControls = doodleText.hasBorders = false;
    doodleText.lockMovementX = doodleText.lockMovementY = true;
    doodleText.selectable = false;
    doodleText.evented = false;

    var screencastText = new fabric.Text('default', { left: leftWidth+278, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    screencastText.text = (language == 0) ? 'ScreenCast' : 'ScreenCast';
    screencastText.hasControls = screencastText.hasBorders = false;
    screencastText.lockMovementX = screencastText.lockMovementY = true;
    screencastText.selectable = false;
    screencastText.evented = false;    

    var galleryText = new fabric.Text('default', { left: leftWidth+498, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    galleryText.text = (language == 0) ? 'Gallery' : 'Galería';
    galleryText.hasControls = galleryText.hasBorders = false;
    galleryText.lockMovementX = galleryText.lockMovementY = true;
    galleryText.selectable = false;
    galleryText.evented = false;

    var storeText = new fabric.Text('default', { left: leftWidth+718, top: topLength+145, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    storeText.text = (language == 0) ? 'Store' : 'Almacenar';
    storeText.hasControls = storeText.hasBorders = false;
    storeText.lockMovementX = storeText.lockMovementY = true;
    storeText.selectable = false;
    storeText.evented = false;    

    var mapsText = new fabric.Text('default', { left: leftWidth+58, top: topLength+395, fontFamily: 'HelveticaLight', fontSize: 32, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    mapsText.text = (language == 0) ? 'Maps' : 'Mapas';
    mapsText.hasControls = mapsText.hasBorders = false;
    mapsText.lockMovementX = mapsText.lockMovementY = true;
    mapsText.selectable = false;
    mapsText.evented = false;   
    
    //    ******** text description below the app icons end
    
    sideApps.add(doodleText);
    sideApps.add(screencastText);
    sideApps.add(galleryText);
    sideApps.add(storeText);
    sideApps.add(mapsText);
}        

// function to display the outside door    
    
function outDoor(){
    
    divOutApps.style.display = 'block';

//    ******iconds start
//    normal icons for doorbell and package
    
    if(dndStatus==0){
    fabric.Image.fromURL('img/doorbell.png', function(doorbell) {
      doorbell.set({left: 140,
      top: 500, originX: 'left', originY: 'top', lockMovementX: true, lockMovementY: true, hasBorders: false, hasControls: false});    
      outApps.add(doorbell);
      doorbell.on('mousedown',function(){
        outApps.deactivateAll();
        switch(doorbellChimeName){
            case 1:
                chime1.load();
                chime1.play();
                break;
            case 2:
                chime2.load();
                chime2.play();
                break;
            case 3:
                chime3.load();
                chime3.play();
                break;
        }
    });
    });
    fabric.Image.fromURL('img/package.png', function(package) {
      package.set({left: 520,
      top: 500, lockMovementX: true, lockMovementY: true, hasBorders: false, hasControls: false});    
      outApps.add(package);
      package.on('mousedown',function(){
          outApps.deactivateAll();
          switch(packageChimeName){
            case 1:
                chime1.load();
                chime1.play();
                break;
            case 2:
                chime2.load();
                chime2.play();
                break;
            case 3:
                chime3.load();
                chime3.play();
                break;
        }
    });    
    });    
    }
    
    //greyed out icons for doorbell and package
    
    else{
      fabric.Image.fromURL('img/doorbellGray.png', function(doorbell) {
      doorbell.set({left: 140,
      top: 500, originX: 'left', originY: 'top', lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      outApps.add(doorbell);
    });
    fabric.Image.fromURL('img/packageGray.png', function(package) {
      package.set({left: 520,
      top: 500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      outApps.add(package);
    });     
        
    }
    

    fabric.Image.fromURL('img/message.png', function(message) {
      message.set({left: 910,
      top: 500, lockMovementX: true, lockMovementY: true, hasControls: false, hasBorders: false});    
      outApps.add(message);
      message.on('mousedown',function(){
           sendOutIn(); 
    });    
    });
    
    // ******icons end
    
    fabric.Image.fromURL('img/keypad.png', function(keypad) {
      keypad.set({left: 53,
      top: 1150, lockMovementX: true, lockMovementY: true,scaleX: 0.9, scaleY:0.9, hasControls: false, hasBorders: false});    
      outApps.add(keypad);
      keypad.on('mousedown',function(){
          outApps.deactivateAll();
          logsJSON.unshift({"mode":"keypad","timeStamp":""+new Date().toLocaleTimeString()+""});
          responsiveVoice.speak((language == 0) ? 'Door Unlocked' : 'Desbloqueo de puerta');
    });    
    });
    
    // handle on the outside door
    
    fabric.Image.fromURL('img/outhandle.png', function(outhandle) {
      outhandle.set({left: 65,
      top: 1325, originX: 'left', lockMovementX: true, lockMovementY: true, scaleX: 0.8, scaleY: 0.8, hasControls: false, hasBorders: false});    
      outApps.add(outhandle);
      outApps.moveTo(outhandle, 50);
      outhandle.on('mousedown',function(){
      logsJSON.unshift({"mode":"fingerprint","timeStamp":""+new Date().toLocaleTimeString()+""});
      responsiveVoice.speak((language == 0) ? 'Door Unlocked' : 'Desbloqueo de puerta');      
      });
    });

    //    ******** text description below the app icons start
    
    var helloText = new fabric.Text('default', { left: 615, top: 260, fontFamily: 'HelveticaLight', fontSize: 105, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px'});
    if(dndStatus == 0){
    helloText.text = (language == 0) ? 'Hello there!' : 'Hola!';}
    else{
    helloText.text = (language == 0) ? 'Do Not Disturb!' : 'No Molestar!';}
    helloText.hasControls = helloText.hasBorders = false;
    helloText.lockMovementX = helloText.lockMovementY = true;
    helloText.selectable = false;
    helloText.evented = false;        

    var doorbellText = new fabric.Text('default', { left: 240, top: 750, fontFamily: 'HelveticaLight', fontSize: 38, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    doorbellText.text = (language == 0) ? 'Ring Bell' : 'Anillo de\nCampana';
    doorbellText.hasControls = doorbellText.hasBorders = false;
    doorbellText.lockMovementX = doorbellText.lockMovementY = true;
    doorbellText.selectable = false;
    doorbellText.evented = false;

    var packageText = new fabric.Text('default', { left: 620, top: 750, fontFamily: 'HelveticaLight', fontSize: 38, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    packageText.text = (language == 0) ? 'Deliver a\nPackage' : 'Entregar\nun Paquete';
    packageText.hasControls = packageText.hasBorders = false;
    packageText.lockMovementX = packageText.lockMovementY = true;
    packageText.selectable = false;
    packageText.evented = false;
    
    var outMessageText = new fabric.Text('default', { left: 1010, top: 750, fontFamily: 'HelveticaLight', fontSize: 38, fontWeight:300, originX: 'center', fill: 'white', shadow: 'black 2px 2px 2px', textAlign: 'center'});
    outMessageText.text = (language == 0) ? 'Leave a\nMessage' : 'Deja un\nMensaje';
    outMessageText.hasControls = outMessageText.hasBorders = false;
    outMessageText.lockMovementX = outMessageText.lockMovementY = true;
    outMessageText.selectable = false;
    outMessageText.evented = false;    

    outApps.add(helloText);    
    outApps.add(doorbellText);    
    outApps.add(packageText);    
    outApps.add(outMessageText);    
    
    //    ******** text description below the app icons end
}
    
function addInhandle(){
    fabric.Image.fromURL('img/inhandle.png', function(inhandle) {
      inhandle.set({left: 1165,
      top: 1325, originX: 'right', lockMovementX: true, lockMovementY: true, scaleX: 0.8, scaleY: 0.8, hasControls: false, hasBorders: false});    
      inWindow.add(inhandle);
      inWindow.moveTo(inhandle, 50);
    });
}
    
//clear and redraw the outside door
    
function restructureOutDoor(){
    outApps.clear();
    outDoor();
    outApps.add(outTimeText);
    outApps.add(outDateText);
}
    
mainscreen();
sidescreen();
addInhandle();
outDoor();
getTime();
getWeather();
    
</script>		
</head>
  
</html>